{"version":3,"sources":["Sheep.js"],"names":["State","cc","Enum","None","Run","Jump","Drop","DropEnd","Dead","Dust","require","Sheep","Class","extends","Component","properties","maxY","groundY","gravity","initJumpSpeed","_state","default","type","visible","state","get","set","value","animName","anim","stop","play","jumpAudio","url","AudioClip","dustPrefab","Prefab","statics","init","getComponent","Animation","currentSpeed","sprite","Sprite","registerInput","startRun","enableInput","eventManager","addListener","event","EventListener","KEYBOARD","onKeyPressed","keyCode","jump","bind","node","TOUCH_ONE_BY_ONE","onTouchBegan","touch","enable","resumeTarget","pauseTarget","update","dt","y","spawnDust","flying","onDropFinished","onCollisionEnter","other","group","game","groupList","groupIndex","D","gameOver","gainScore","audioEngine","playEffect","dust","pool","hasObject","getFromPool","instantiate","parent","addChild","position","playAnim"],"mappings":"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","file":"Sheep.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["//-- 绵羊状态\nvar State = cc.Enum({\n    None   : -1,\n    Run    : -1,\n    Jump   : -1,\n    Drop   : -1,\n    DropEnd: -1,\n    Dead   : -1\n});\n\nvar Dust = require('Dust');\n\nvar Sheep = cc.Class({\n    //-- 继承\n    extends: cc.Component,\n    //-- 属性\n    properties: {\n        //-- Y轴最大高度\n        maxY: 0,\n        //-- 地面高度\n        groundY: 0,\n        //-- 重力\n        gravity: 0,\n        //-- 起跳速度\n        initJumpSpeed: 0,\n        //-- 绵羊状态\n        _state: {\n            default: State.None,\n            type: State,\n            visible: false\n        },\n        state: {\n            get: function () {\n                return this._state;\n            },\n            set: function(value){\n                if (value !== this._state) {\n                    this._state = value;\n                    if (this._state !== State.None) {\n                        var animName = State[this._state];\n                        this.anim.stop();\n                        this.anim.play(animName);\n                    }\n                }\n            },\n            type: State\n        },\n        //-- 获取Jump音效\n        jumpAudio: {\n            default: null,\n            url: cc.AudioClip\n        },\n        dustPrefab: cc.Prefab\n    },\n    statics: {\n        State: State\n    },\n    init () {\n        //-- 当前播放动画组件\n        this.anim = this.getComponent(cc.Animation);\n        //-- 当前速度\n        this.currentSpeed = 0;\n        //-- 绵羊图片渲染\n        this.sprite = this.getComponent(cc.Sprite);\n        this.registerInput();\n    },\n    startRun () {\n        this.state = State.Run;\n        this.enableInput(true);\n    },\n    //-- 初始化\n    registerInput () {\n        //-- 添加绵羊控制事件(为了注销事件缓存事件)\n        cc.eventManager.addListener({\n            event: cc.EventListener.KEYBOARD,\n            onKeyPressed: function(keyCode, event) {\n                this.jump();\n            }.bind(this)\n        }, this.node);\n        // touch input\n        cc.eventManager.addListener({\n            event: cc.EventListener.TOUCH_ONE_BY_ONE,\n            onTouchBegan: function(touch, event) {\n                this.jump();\n                return true;\n            }.bind(this)\n        }, this.node);\n    },\n    //-- 删除\n    enableInput: function (enable) {\n        if (enable) {\n            cc.eventManager.resumeTarget(this.node);\n        } else {\n            cc.eventManager.pauseTarget(this.node);\n        }\n    },\n\n    //-- 更新\n    update (dt) {\n        switch (this.state) {\n            case State.Jump:\n                if (this.currentSpeed < 0) {\n                    this.state = State.Drop;\n                }\n                break;\n            case State.Drop:\n                if (this.node.y < this.groundY) {\n                    this.node.y = this.groundY;\n                    this.state = State.DropEnd;\n                    this.spawnDust('DustDown');\n                }\n                break;\n            case State.None:\n            case State.Dead:\n                return;\n        }\n        var flying = this.state === State.Jump || this.node.y > this.groundY;\n        if (flying) {\n            this.currentSpeed -= dt * this.gravity;\n            this.node.y += dt * this.currentSpeed;\n        }\n    },\n\n    // invoked by animation\n    onDropFinished () {\n        this.state = State.Run;\n    },\n\n    onCollisionEnter: function (other) {\n        if (this.state !== State.Dead) {\n            var group = cc.game.groupList[other.node.groupIndex];\n            if (group === 'Obstacle') {\n                // bump\n                this.state = Sheep.State.Dead;\n                D.game.gameOver();\n                this.enableInput(false);\n            }\n            else if (group === 'NextPipe') {\n                // jump over\n                D.game.gainScore();\n            }\n       }\n    },\n\n    //-- 开始跳跃设置状态数据，播放动画\n    jump: function () {\n        this.state = State.Jump;\n        this.currentSpeed = this.initJumpSpeed;\n        //-- 播放跳音效\n        cc.audioEngine.playEffect(this.jumpAudio);\n        this.spawnDust('DustUp');\n    },\n    spawnDust (animName) {\n        let dust = null;\n        if (cc.pool.hasObject(Dust)) {\n            dust = cc.pool.getFromPool(Dust);\n        } else {\n            dust = cc.instantiate(this.dustPrefab).getComponent(Dust);\n        }\n        this.node.parent.addChild(dust.node);\n        dust.node.position = this.node.position;\n        dust.playAnim(animName);\n    }\n});\n"]}